REPLIT PROMPT C0 — Public Search Disclosure Audit (Truth vs Disclosure, NO LEAKS)

ROLE: Senior Platform Architect + Security/Disclosure QA Gatekeeper

PURPOSE:
Prove that public search for Experience Bamfield will only return disclosed inventory, never “truth inventory,” and document the exact enforcement points (routes/services/SQL) for:

GET /api/public/cc_portals/:slug/availability

This audit must confirm the endpoint is safe to expose on experiencebamfield.com.

HARD CONSTRAINTS

Audit only. No implementation changes.

Evidence required: file paths + line ranges + (if SQL) the exact where-clauses or filters.

DO NOT propose adding “cart.”

Terminology: reserve/reservation.

TASKS
1) Locate the availability route + handler

Find the exact server file and handler for:

GET /api/public/cc_portals/:slug/availability

Output:

file path + line range

the service function(s) it calls

2) Identify the disclosure gate(s)

For the availability query, identify how it restricts results to disclosed inventory:

You must explicitly answer:

What table/field represents disclosure/publishing? (examples: is_published, visibility, disclosure_state, offer_status, portal_listing_state, etc.)

What where clauses enforce disclosure?

Are there joins to “offers/listings” that exclude private inventory?

Is there portal scoping that limits inventory to Experience’s permitted set?

Output:

exact code evidence of filters/joins

3) Attempted leakage paths (threat model)

Identify any realistic ways undisclosed assets could leak, including:

assets with schedules but no published listing

assets attached to tenant but not portal

internal-only offers

mis-scoped portalSlug

direct assetId lookup via query params

For each, state whether it is blocked and where.

4) Confirm “truth” search system integration

Your system has Truth vs Disclosure layers. Confirm whether this endpoint:

uses the Truth engine and then applies disclosure filters, OR

uses a Disclosure-only view/query from the start

Output:

which services/tables are used

whether any “truth” tables are touched

5) Produce audit files

Write:

proof/experiencebamfield/public-search-disclosure-audit.md

Route map

Disclosure enforcement evidence

Threat model + conclusions

Explicit “SAFE/NOT SAFE to expose publicly” conclusion

proof/experiencebamfield/public-search-disclosure-audit-queries.md

Any SQL snippets or query-builder excerpts with filters highlighted

SUCCESS CRITERIA

We have hard evidence that public availability only returns disclosed inventory.

We know exactly what needs to be configured for Experience Bamfield to show only disclosed listings.

If unsafe, we have a precise list of changes required (but do not implement in this prompt).

What happens after this audit

If SAFE → we proceed with Prompt C (Search + Results UI) but we’ll keep it strictly using the existing disclosure-safe endpoint.

If NOT SAFE → we write Prompt C1 to harden the endpoint (disclosure gate fixes) before any UI goes live.