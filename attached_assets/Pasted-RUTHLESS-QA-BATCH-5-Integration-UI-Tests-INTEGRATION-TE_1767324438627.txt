RUTHLESS QA - BATCH 5: Integration & UI Tests

## INTEGRATION TEST 1: Search → Book flow
1. Search for properties in Okanagan with power:
   GET /api/staging/search?region=Okanagan&needsPower=true

2. Pick first result, get details:
   GET /api/staging/properties/[ID]

3. Create booking for that property:
   POST /api/staging/bookings with propertyId from step 2

4. Verify booking references correct property:
   GET /api/staging/bookings/[BOOKING_REF]
   
EXPECTED: Complete flow works, booking.propertyId matches original
FAIL if: any step fails or data mismatch

## INTEGRATION TEST 2: Trip Plan → Book stops
1. Plan a trip Vancouver to Victoria
2. Get properties along route
3. Create a trip with 2 stops
4. For each stop, create a booking
5. Verify bookings exist for both properties

EXPECTED: Can book multiple properties from a planned trip
FAIL if: bookings fail

## INTEGRATION TEST 3: Chamber → Property → Booking flow
1. Convert a chamber opportunity to property
2. Verify property created
3. Try to book the new property

Note: New property is status='pending_setup' so booking may fail - that's OK!
EXPECTED: Clear error if property not ready for booking
FAIL if: 500 error

## INTEGRATION TEST 4: Service providers with bookings
1. Find a property with service providers:
```sql
SELECT DISTINCT sp.id, sp.name 
FROM staging_properties sp
JOIN staging_service_providers ssp ON ssp.property_id = sp.id
WHERE ssp.is_active = true LIMIT 1;
```

2. Get property detail - verify providers included
3. Create booking for that property
4. Verify booking doesn't break provider display

EXPECTED: Service providers visible before and after booking
FAIL if: providers disappear or error

## UI SMOKE TEST 1: Search Page
Navigate to /staging
- [ ] Page loads without console errors
- [ ] Filter sidebar visible
- [ ] Properties display in grid
- [ ] Score badges visible (Crew/RV/Trucker)
- [ ] Clicking property goes to detail page

## UI SMOKE TEST 2: Property Detail
Navigate to /staging/[ID] for Save Paradise Parking
- [ ] Page loads with property name
- [ ] Amenities section visible
- [ ] Spots list shows
- [ ] Service providers section shows Bamfield Diesel Doctor
- [ ] Mike Thornton name visible
- [ ] RESIDENT badge visible
- [ ] Book button present
- [ ] Pricing sidebar shows rates

## UI SMOKE TEST 3: Booking Flow
Click Book on any property
- [ ] Step 1 (Dates) loads
- [ ] Can select dates
- [ ] Price updates when dates selected
- [ ] Step 2 (Vehicle) accessible
- [ ] Step 3 (Guest Info) accessible
- [ ] Step 4 (Review) shows all entered data
- [ ] Submit creates booking
- [ ] Step 5 (Confirmation) shows booking ref

## UI SMOKE TEST 4: Trip Planner
Navigate to /staging/trip-planner
- [ ] Page loads
- [ ] Popular routes display
- [ ] Can type in origin/destination
- [ ] City autocomplete works
- [ ] "Find Stops" button works
- [ ] Properties appear along route
- [ ] Can click to select stops
- [ ] Distance from origin shows for each property

## UI SMOKE TEST 5: Chamber Dashboard
Navigate to /staging/chamber
- [ ] Page loads
- [ ] Stats cards show numbers
- [ ] Opportunities table displays
- [ ] Status badges colored correctly
- [ ] Filter buttons work
- [ ] Can change opportunity status
- [ ] Convert button works (on interested opportunities)

## PERFORMANCE TEST 1: Search response time
```bash
time curl "http://localhost:5000/api/staging/search?region=Vancouver%20Island&needsPower=true&vehicleLengthFt=35"
```
EXPECTED: < 500ms
FAIL if: > 2 seconds

## PERFORMANCE TEST 2: Trip planning response time
```bash
time curl -X POST http://localhost:5000/api/staging/trips/plan \
  -H "Content-Type: application/json" \
  -d '{"originLat": 49.2827, "originLng": -123.1207, "destLat": 50.7235, "destLng": -127.4937, "bufferKm": 100}'
```
EXPECTED: < 1 second
FAIL if: > 3 seconds

## ERROR HANDLING TEST 1: Invalid JSON
```bash
curl -X POST http://localhost:5000/api/staging/bookings \
  -H "Content-Type: application/json" \
  -d 'this is not json'
```
EXPECTED: 400 error, not 500
FAIL if: 500 error or server crash

## ERROR HANDLING TEST 2: Wrong content type
```bash
curl -X POST http://localhost:5000/api/staging/bookings \
  -H "Content-Type: text/plain" \
  -d '{"propertyId": 1}'
```
EXPECTED: 400 error about content type or JSON parsing
FAIL if: 500 error

## ERROR HANDLING TEST 3: Massive payload
```bash
curl -X POST http://localhost:5000/api/staging/bookings \
  -H "Content-Type: application/json" \
  -d '{"guestName": "'$(python3 -c "print('A'*1000000)")'"}'
```
EXPECTED: 400 or 413 error (payload too large)
FAIL if: 500 error or server hang

Report all results with PASS/FAIL and any bugs found.