Test all API endpoints. Create a test file and run it.

Create file: server/tests/staging-api-tests.ts

import fetch from 'node-fetch';

const BASE_URL = 'http://localhost:5000'; // adjust port as needed
const results: { test: string; passed: boolean; error?: string }[] = [];

async function test(name: string, fn: () => Promise<void>) {
    try {
        await fn();
        results.push({ test: name, passed: true });
        console.log(`âœ… ${name}`);
    } catch (error: any) {
        results.push({ test: name, passed: false, error: error.message });
        console.log(`âŒ ${name}: ${error.message}`);
    }
}

function assert(condition: boolean, message: string) {
    if (!condition) throw new Error(message);
}

async function runTests() {
    console.log('\nðŸ§ª STAGING API TESTS\n');

    // =========================================================================
    // SEARCH ENDPOINT TESTS
    // =========================================================================
    
    await test('GET /api/staging/search - basic search', async () => {
        const res = await fetch(`${BASE_URL}/api/staging/search`);
        assert(res.ok, `Status ${res.status}`);
        const data = await res.json();
        assert(Array.isArray(data.properties), 'properties should be array');
        assert(data.properties.length > 0, 'should have at least 1 property');
    });

    await test('GET /api/staging/search - with vehicle length filter', async () => {
        const res = await fetch(`${BASE_URL}/api/staging/search?vehicleLengthFt=45`);
        const data = await res.json();
        assert(res.ok, `Status ${res.status}`);
        // All results should fit a 45ft rig
        data.properties.forEach((p: any) => {
            assert(p.maxCombinedLengthFt >= 45, `Property ${p.name} maxLength ${p.maxCombinedLengthFt} < 45`);
        });
    });

    await test('GET /api/staging/search - with power filter', async () => {
        const res = await fetch(`${BASE_URL}/api/staging/search?needsPower=true&powerAmps=50`);
        const data = await res.json();
        assert(res.ok, `Status ${res.status}`);
        data.properties.forEach((p: any) => {
            assert(p.hasShorePower === true, `Property ${p.name} should have power`);
        });
    });

    await test('GET /api/staging/search - with multiple filters', async () => {
        const res = await fetch(
            `${BASE_URL}/api/staging/search?` +
            `vehicleLengthFt=60&needsPower=true&acceptsSemi=true&region=Vancouver%20Island`
        );
        const data = await res.json();
        assert(res.ok, `Status ${res.status}`);
        // Should return Save Paradise Parking
    });

    await test('GET /api/staging/search - horse friendly filter', async () => {
        const res = await fetch(`${BASE_URL}/api/staging/search?isHorseFriendly=true`);
        const data = await res.json();
        assert(res.ok, `Status ${res.status}`);
        data.properties.forEach((p: any) => {
            assert(p.isHorseFriendly === true, `Property ${p.name} should be horse friendly`);
        });
    });

    await test('GET /api/staging/search - mechanic filter', async () => {
        const res = await fetch(`${BASE_URL}/api/staging/search?hasMechanic=true`);
        const data = await res.json();
        assert(res.ok, `Status ${res.status}`);
        data.properties.forEach((p: any) => {
            assert(p.hasOnsiteMechanic === true, `Property ${p.name} should have mechanic`);
        });
    });

    await test('GET /api/staging/search - sort by price low', async () => {
        const res = await fetch(`${BASE_URL}/api/staging/search?sortBy=price_low`);
        const data = await res.json();
        assert(res.ok, `Status ${res.status}`);
        // Verify sorted
        for (let i = 1; i < data.properties.length; i++) {
            const prev = data.properties[i-1].baseNightlyRate || 0;
            const curr = data.properties[i].baseNightlyRate || 0;
            assert(curr >= prev, 'Should be sorted by price ascending');
        }
    });

    await test('GET /api/staging/search - pagination', async () => {
        const res1 = await fetch(`${BASE_URL}/api/staging/search?limit=1&offset=0`);
        const data1 = await res1.json();
        const res2 = await fetch(`${BASE_URL}/api/staging/search?limit=1&offset=1`);
        const data2 = await res2.json();
        if (data1.properties.length > 0 && data2.properties.length > 0) {
            assert(data1.properties[0].id !== data2.properties[0].id, 'Pagination should return different results');
        }
    });

    // =========================================================================
    // PROPERTY ENDPOINT TESTS
    // =========================================================================

    await test('GET /api/staging/properties - list all', async () => {
        const res = await fetch(`${BASE_URL}/api/staging/properties`);
        assert(res.ok, `Status ${res.status}`);
        const data = await res.json();
        assert(Array.isArray(data.properties || data), 'Should return array');
    });

    await test('GET /api/staging/properties/:id - valid ID', async () => {
        // First get a property ID
        const listRes = await fetch(`${BASE_URL}/api/staging/properties`);
        const listData = await listRes.json();
        const properties = listData.properties || listData;
        if (properties.length > 0) {
            const id = properties[0].id;
            const res = await fetch(`${BASE_URL}/api/staging/properties/${id}`);
            assert(res.ok, `Status ${res.status}`);
            const data = await res.json();
            assert(data.property || data.id, 'Should return property');
        }
    });

    await test('GET /api/staging/properties/:id - invalid ID', async () => {
        const res = await fetch(`${BASE_URL}/api/staging/properties/99999`);
        assert(res.status === 404, `Should return 404, got ${res.status}`);
    });

    await test('GET /api/staging/properties/:id/spots', async () => {
        const listRes = await fetch(`${BASE_URL}/api/staging/properties`);
        const listData = await listRes.json();
        const properties = listData.properties || listData;
        if (properties.length > 0) {
            const id = properties[0].id;
            const res = await fetch(`${BASE_URL}/api/staging/properties/${id}/spots`);
            assert(res.ok, `Status ${res.status}`);
            const data = await res.json();
            assert(Array.isArray(data.spots || data), 'Should return array');
        }
    });

    await test('GET /api/staging/properties/:id/calendar', async () => {
        const listRes = await fetch(`${BASE_URL}/api/staging/properties`);
        const listData = await listRes.json();
        const properties = listData.properties || listData;
        if (properties.length > 0) {
            const id = properties[0].id;
            const res = await fetch(`${BASE_URL}/api/staging/properties/${id}/calendar`);
            assert(res.ok, `Status ${res.status}`);
        }
    });

    await test('GET /api/staging/stats', async () => {
        const res = await fetch(`${BASE_URL}/api/staging/stats`);
        assert(res.ok, `Status ${res.status}`);
        const data = await res.json();
        assert(typeof data.totalProperties === 'number', 'Should have totalProperties');
    });

    // =========================================================================
    // ERROR HANDLING TESTS
    // =========================================================================

    await test('Invalid endpoint returns 404', async () => {
        const res = await fetch(`${BASE_URL}/api/staging/nonexistent`);
        assert(res.status === 404, `Should return 404, got ${res.status}`);
    });

    await test('Invalid query params handled gracefully', async () => {
        const res = await fetch(`${BASE_URL}/api/staging/search?vehicleLengthFt=notanumber`);
        // Should either return 400 or handle gracefully (not 500)
        assert(res.status !== 500, `Should not return 500, got ${res.status}`);
    });

    // =========================================================================
    // SUMMARY
    // =========================================================================
    
    console.log('\nðŸ“Š TEST SUMMARY');
    console.log('================');
    const passed = results.filter(r => r.passed).length;
    const failed = results.filter(r => !r.passed).length;
    console.log(`Passed: ${passed}`);
    console.log(`Failed: ${failed}`);
    
    if (failed > 0) {
        console.log('\nâŒ FAILED TESTS:');
        results.filter(r => !r.passed).forEach(r => {
            console.log(`  - ${r.test}: ${r.error}`);
        });
    }
}

runTests().catch(console.error);

---

Run this test file:
npx ts-node server/tests/staging-api-tests.ts

Or if that doesn't work, convert to JavaScript and run with node.
Report all failures.