# PROMPT 24 - BUNDLE 101: Seed Actor Types & Plans

## Context
- Previous migration: 100_actor_types_roles_plans_subscriptions.sql
- This is migration 101
- Part of Prompt 24A - Seed data

## Objective
Seed the 5 actor types and 15 subscription plans with their entitlements.

---

## Migration: server/migrations/101_seed_actor_types_and_plans.sql

```sql
-- ============================================================
-- MIGRATION 101: SEED ACTOR TYPES & PLANS
-- Part of Prompt 24A - Seed Data
-- ============================================================

BEGIN;

-- ============================================================
-- 1) SEED ACTOR TYPES (5 Economic Roles)
-- ============================================================

INSERT INTO cc_actor_types (code, name, description, sort_order) VALUES
  ('CONTRACTOR', 'Contractor', 'Service run operators, trades, construction crews', 1),
  ('INVENTORY', 'Inventory Operator', 'STR owners, marina operators, parking lot owners, equipment rental', 2),
  ('PIC', 'Property Infrastructure Coordinator', 'Cross-property coordination, turnover orchestration, workforce management', 3),
  ('WORKER', 'Worker', 'Seasonal workers, housekeepers, maintenance crew, guides', 4),
  ('COORDINATOR', 'Coordinator', 'Chamber desk, dispatch operators, emergency coordinators', 5)
ON CONFLICT (code) DO UPDATE SET
  name = EXCLUDED.name,
  description = EXCLUDED.description,
  sort_order = EXCLUDED.sort_order,
  updated_at = now();

-- ============================================================
-- 2) SEED CONTRACTOR PLANS (3 tiers)
-- ============================================================

-- C-STARTER: $149/mo
INSERT INTO cc_plans (actor_type_id, code, name, description, monthly_price, tier_level, sort_order)
SELECT id, 'C-STARTER', 'Contractor Starter', 
  '1 region, 5 active runs, 10 run-days/month, 3 crew max',
  149, 1, 1
FROM cc_actor_types WHERE code = 'CONTRACTOR'
ON CONFLICT (actor_type_id, code) DO UPDATE SET
  name = EXCLUDED.name,
  description = EXCLUDED.description,
  monthly_price = EXCLUDED.monthly_price,
  updated_at = now();

-- C-PRO: $399/mo
INSERT INTO cc_plans (actor_type_id, code, name, description, monthly_price, tier_level, sort_order)
SELECT id, 'C-PRO', 'Contractor Pro',
  '10 regions, 50 runs, workforce attraction, procurement coordination',
  399, 2, 2
FROM cc_actor_types WHERE code = 'CONTRACTOR'
ON CONFLICT (actor_type_id, code) DO UPDATE SET
  name = EXCLUDED.name,
  description = EXCLUDED.description,
  monthly_price = EXCLUDED.monthly_price,
  updated_at = now();

-- C-ENTERPRISE: $1,499/mo
INSERT INTO cc_plans (actor_type_id, code, name, description, monthly_price, tier_level, sort_order)
SELECT id, 'C-ENTERPRISE', 'Contractor Enterprise',
  'Unlimited regions & runs, guaranteed crew, API access, priority support',
  1499, 3, 3
FROM cc_actor_types WHERE code = 'CONTRACTOR'
ON CONFLICT (actor_type_id, code) DO UPDATE SET
  name = EXCLUDED.name,
  description = EXCLUDED.description,
  monthly_price = EXCLUDED.monthly_price,
  updated_at = now();

-- ============================================================
-- 3) SEED INVENTORY OPERATOR PLANS (3 tiers)
-- ============================================================

-- I-BASIC: $49/mo
INSERT INTO cc_plans (actor_type_id, code, name, description, monthly_price, tier_level, sort_order)
SELECT id, 'I-BASIC', 'Inventory Basic',
  'Request-only mode, basic disclosure, calendar sync',
  49, 1, 1
FROM cc_actor_types WHERE code = 'INVENTORY'
ON CONFLICT (actor_type_id, code) DO UPDATE SET
  name = EXCLUDED.name,
  description = EXCLUDED.description,
  monthly_price = EXCLUDED.monthly_price,
  updated_at = now();

-- I-YIELD-PRO: $199/mo
INSERT INTO cc_plans (actor_type_id, code, name, description, monthly_price, tier_level, sort_order)
SELECT id, 'I-YIELD-PRO', 'Inventory Yield Pro',
  'Truth vs disclosure layer, seasonal profiles, bundling participation',
  199, 2, 2
FROM cc_actor_types WHERE code = 'INVENTORY'
ON CONFLICT (actor_type_id, code) DO UPDATE SET
  name = EXCLUDED.name,
  description = EXCLUDED.description,
  monthly_price = EXCLUDED.monthly_price,
  updated_at = now();

-- I-WORKFORCE: $499/mo
INSERT INTO cc_plans (actor_type_id, code, name, description, monthly_price, tier_level, sort_order)
SELECT id, 'I-WORKFORCE', 'Inventory Workforce',
  'Staff coordination, housing bundles, workforce calendar integration',
  499, 3, 3
FROM cc_actor_types WHERE code = 'INVENTORY'
ON CONFLICT (actor_type_id, code) DO UPDATE SET
  name = EXCLUDED.name,
  description = EXCLUDED.description,
  monthly_price = EXCLUDED.monthly_price,
  updated_at = now();

-- ============================================================
-- 4) SEED PIC PLANS (3 tiers)
-- ============================================================

-- PIC-STARTER: $249/mo
INSERT INTO cc_plans (actor_type_id, code, name, description, monthly_price, tier_level, sort_order)
SELECT id, 'PIC-STARTER', 'PIC Starter',
  '5 properties, basic coordination, turnover scheduling',
  249, 1, 1
FROM cc_actor_types WHERE code = 'PIC'
ON CONFLICT (actor_type_id, code) DO UPDATE SET
  name = EXCLUDED.name,
  description = EXCLUDED.description,
  monthly_price = EXCLUDED.monthly_price,
  updated_at = now();

-- PIC-PRO: $599/mo
INSERT INTO cc_plans (actor_type_id, code, name, description, monthly_price, tier_level, sort_order)
SELECT id, 'PIC-PRO', 'PIC Pro',
  '25 properties, turnover orchestration, worker pool management',
  599, 2, 2
FROM cc_actor_types WHERE code = 'PIC'
ON CONFLICT (actor_type_id, code) DO UPDATE SET
  name = EXCLUDED.name,
  description = EXCLUDED.description,
  monthly_price = EXCLUDED.monthly_price,
  updated_at = now();

-- PIC-ENTERPRISE: $1,499/mo
INSERT INTO cc_plans (actor_type_id, code, name, description, monthly_price, tier_level, sort_order)
SELECT id, 'PIC-ENTERPRISE', 'PIC Enterprise',
  'Unlimited properties, multi-team leads, cross-region ops, analytics',
  1499, 3, 3
FROM cc_actor_types WHERE code = 'PIC'
ON CONFLICT (actor_type_id, code) DO UPDATE SET
  name = EXCLUDED.name,
  description = EXCLUDED.description,
  monthly_price = EXCLUDED.monthly_price,
  updated_at = now();

-- ============================================================
-- 5) SEED WORKER PLANS (3 tiers)
-- ============================================================

-- W-FREE: $0
INSERT INTO cc_plans (actor_type_id, code, name, description, monthly_price, tier_level, sort_order)
SELECT id, 'W-FREE', 'Worker Free',
  'Basic profile, job applications, messaging',
  0, 1, 1
FROM cc_actor_types WHERE code = 'WORKER'
ON CONFLICT (actor_type_id, code) DO UPDATE SET
  name = EXCLUDED.name,
  description = EXCLUDED.description,
  monthly_price = EXCLUDED.monthly_price,
  updated_at = now();

-- W-VERIFIED: $99/year (stored as $8.25/mo equivalent)
INSERT INTO cc_plans (actor_type_id, code, name, description, monthly_price, annual_price, tier_level, sort_order)
SELECT id, 'W-VERIFIED', 'Worker Verified',
  'Priority matching, verified badge, housing-first access',
  0, 99, 2, 2
FROM cc_actor_types WHERE code = 'WORKER'
ON CONFLICT (actor_type_id, code) DO UPDATE SET
  name = EXCLUDED.name,
  description = EXCLUDED.description,
  monthly_price = EXCLUDED.monthly_price,
  annual_price = EXCLUDED.annual_price,
  updated_at = now();

-- W-SEASONAL: $49/season
INSERT INTO cc_plans (actor_type_id, code, name, description, seasonal_price, tier_level, billing_interval, sort_order)
SELECT id, 'W-SEASONAL', 'Worker Seasonal',
  'Seasonal housing-first, coordination bundles, priority placement',
  49, 2, 'seasonal', 3
FROM cc_actor_types WHERE code = 'WORKER'
ON CONFLICT (actor_type_id, code) DO UPDATE SET
  name = EXCLUDED.name,
  description = EXCLUDED.description,
  seasonal_price = EXCLUDED.seasonal_price,
  billing_interval = EXCLUDED.billing_interval,
  updated_at = now();

-- ============================================================
-- 6) SEED COORDINATOR PLANS (3 tiers)
-- O-* prefix to distinguish from Operators (business operators)
-- ============================================================

-- O-DESK: $199/mo
INSERT INTO cc_plans (actor_type_id, code, name, description, monthly_price, tier_level, sort_order)
SELECT id, 'O-DESK', 'Coordinator Desk',
  '25 cases/month, dashboard, cross-tenant request handling',
  199, 1, 1
FROM cc_actor_types WHERE code = 'COORDINATOR'
ON CONFLICT (actor_type_id, code) DO UPDATE SET
  name = EXCLUDED.name,
  description = EXCLUDED.description,
  monthly_price = EXCLUDED.monthly_price,
  updated_at = now();

-- O-PRO: $499/mo
INSERT INTO cc_plans (actor_type_id, code, name, description, monthly_price, tier_level, sort_order)
SELECT id, 'O-PRO', 'Coordinator Pro',
  '100 cases/month, incident workflows, evidence logging',
  499, 2, 2
FROM cc_actor_types WHERE code = 'COORDINATOR'
ON CONFLICT (actor_type_id, code) DO UPDATE SET
  name = EXCLUDED.name,
  description = EXCLUDED.description,
  monthly_price = EXCLUDED.monthly_price,
  updated_at = now();

-- O-COMMAND: $1,499/mo
INSERT INTO cc_plans (actor_type_id, code, name, description, monthly_price, tier_level, sort_order)
SELECT id, 'O-COMMAND', 'Coordinator Command',
  'Unlimited cases, emergency dispatch, escalation paths, group travel',
  1499, 3, 3
FROM cc_actor_types WHERE code = 'COORDINATOR'
ON CONFLICT (actor_type_id, code) DO UPDATE SET
  name = EXCLUDED.name,
  description = EXCLUDED.description,
  monthly_price = EXCLUDED.monthly_price,
  updated_at = now();

-- ============================================================
-- 7) SEED KEY ENTITLEMENTS FOR EACH PLAN
-- ============================================================

-- Helper function to insert entitlements
DO $$
DECLARE
  plan_record RECORD;
BEGIN
  -- CONTRACTOR ENTITLEMENTS
  FOR plan_record IN SELECT id, code FROM cc_plans WHERE code LIKE 'C-%' LOOP
    -- max_regions
    INSERT INTO cc_plan_entitlements (plan_id, entitlement_key, value_type, numeric_value, display_name)
    VALUES (
      plan_record.id, 
      'max_regions', 
      'numeric',
      CASE plan_record.code 
        WHEN 'C-STARTER' THEN 1 
        WHEN 'C-PRO' THEN 10 
        ELSE NULL 
      END,
      'Maximum Regions'
    ) ON CONFLICT (plan_id, entitlement_key) DO UPDATE SET numeric_value = EXCLUDED.numeric_value;
    
    -- max_active_runs
    INSERT INTO cc_plan_entitlements (plan_id, entitlement_key, value_type, numeric_value, display_name)
    VALUES (
      plan_record.id, 
      'max_active_runs', 
      'numeric',
      CASE plan_record.code 
        WHEN 'C-STARTER' THEN 5 
        WHEN 'C-PRO' THEN 50 
        ELSE NULL 
      END,
      'Maximum Active Runs'
    ) ON CONFLICT (plan_id, entitlement_key) DO UPDATE SET numeric_value = EXCLUDED.numeric_value;
    
    -- max_run_days_per_month
    INSERT INTO cc_plan_entitlements (plan_id, entitlement_key, value_type, numeric_value, display_name)
    VALUES (
      plan_record.id, 
      'max_run_days_per_month', 
      'numeric',
      CASE plan_record.code 
        WHEN 'C-STARTER' THEN 10 
        WHEN 'C-PRO' THEN 40 
        ELSE NULL 
      END,
      'Run Days per Month'
    ) ON CONFLICT (plan_id, entitlement_key) DO UPDATE SET numeric_value = EXCLUDED.numeric_value;
    
    -- workforce_attraction
    INSERT INTO cc_plan_entitlements (plan_id, entitlement_key, value_type, boolean_value, display_name)
    VALUES (
      plan_record.id, 
      'workforce_attraction', 
      'boolean',
      plan_record.code IN ('C-PRO', 'C-ENTERPRISE'),
      'Workforce Attraction Tools'
    ) ON CONFLICT (plan_id, entitlement_key) DO UPDATE SET boolean_value = EXCLUDED.boolean_value;
    
    -- api_access
    INSERT INTO cc_plan_entitlements (plan_id, entitlement_key, value_type, boolean_value, display_name)
    VALUES (
      plan_record.id, 
      'api_access', 
      'boolean',
      plan_record.code = 'C-ENTERPRISE',
      'API Access'
    ) ON CONFLICT (plan_id, entitlement_key) DO UPDATE SET boolean_value = EXCLUDED.boolean_value;
  END LOOP;

  -- PIC ENTITLEMENTS
  FOR plan_record IN SELECT id, code FROM cc_plans WHERE code LIKE 'PIC-%' LOOP
    -- max_properties
    INSERT INTO cc_plan_entitlements (plan_id, entitlement_key, value_type, numeric_value, display_name)
    VALUES (
      plan_record.id, 
      'max_properties', 
      'numeric',
      CASE plan_record.code 
        WHEN 'PIC-STARTER' THEN 5 
        WHEN 'PIC-PRO' THEN 25 
        ELSE NULL 
      END,
      'Maximum Properties'
    ) ON CONFLICT (plan_id, entitlement_key) DO UPDATE SET numeric_value = EXCLUDED.numeric_value;
    
    -- turnover_orchestration
    INSERT INTO cc_plan_entitlements (plan_id, entitlement_key, value_type, boolean_value, display_name)
    VALUES (
      plan_record.id, 
      'turnover_orchestration', 
      'boolean',
      plan_record.code IN ('PIC-PRO', 'PIC-ENTERPRISE'),
      'Turnover Orchestration'
    ) ON CONFLICT (plan_id, entitlement_key) DO UPDATE SET boolean_value = EXCLUDED.boolean_value;
    
    -- worker_pool_management
    INSERT INTO cc_plan_entitlements (plan_id, entitlement_key, value_type, boolean_value, display_name)
    VALUES (
      plan_record.id, 
      'worker_pool_management', 
      'boolean',
      plan_record.code IN ('PIC-PRO', 'PIC-ENTERPRISE'),
      'Worker Pool Management'
    ) ON CONFLICT (plan_id, entitlement_key) DO UPDATE SET boolean_value = EXCLUDED.boolean_value;
  END LOOP;

  -- COORDINATOR ENTITLEMENTS
  FOR plan_record IN SELECT id, code FROM cc_plans WHERE code LIKE 'O-%' LOOP
    -- max_cases_per_month
    INSERT INTO cc_plan_entitlements (plan_id, entitlement_key, value_type, numeric_value, display_name)
    VALUES (
      plan_record.id, 
      'max_cases_per_month', 
      'numeric',
      CASE plan_record.code 
        WHEN 'O-DESK' THEN 25 
        WHEN 'O-PRO' THEN 100 
        ELSE NULL 
      END,
      'Cases per Month'
    ) ON CONFLICT (plan_id, entitlement_key) DO UPDATE SET numeric_value = EXCLUDED.numeric_value;
    
    -- emergency_dispatch
    INSERT INTO cc_plan_entitlements (plan_id, entitlement_key, value_type, boolean_value, display_name)
    VALUES (
      plan_record.id, 
      'emergency_dispatch', 
      'boolean',
      plan_record.code = 'O-COMMAND',
      'Emergency Dispatch'
    ) ON CONFLICT (plan_id, entitlement_key) DO UPDATE SET boolean_value = EXCLUDED.boolean_value;
  END LOOP;

  -- WORKER ENTITLEMENTS
  FOR plan_record IN SELECT id, code FROM cc_plans WHERE code LIKE 'W-%' LOOP
    -- priority_matching
    INSERT INTO cc_plan_entitlements (plan_id, entitlement_key, value_type, boolean_value, display_name)
    VALUES (
      plan_record.id, 
      'priority_matching', 
      'boolean',
      plan_record.code IN ('W-VERIFIED', 'W-SEASONAL'),
      'Priority Job Matching'
    ) ON CONFLICT (plan_id, entitlement_key) DO UPDATE SET boolean_value = EXCLUDED.boolean_value;
    
    -- housing_first_access
    INSERT INTO cc_plan_entitlements (plan_id, entitlement_key, value_type, boolean_value, display_name)
    VALUES (
      plan_record.id, 
      'housing_first_access', 
      'boolean',
      plan_record.code IN ('W-VERIFIED', 'W-SEASONAL'),
      'Housing-First Access'
    ) ON CONFLICT (plan_id, entitlement_key) DO UPDATE SET boolean_value = EXCLUDED.boolean_value;
  END LOOP;
END $$;

COMMIT;
```

---

## Acceptance Criteria

1. [ ] Migration 101 runs without errors
2. [ ] 5 actor types seeded (CONTRACTOR, INVENTORY, PIC, WORKER, COORDINATOR)
3. [ ] 15 plans seeded (3 per actor type)
4. [ ] Plan entitlements seeded for key limits
5. [ ] Idempotent - can run multiple times without errors

---

## Test Queries

```sql
-- Verify actor types
SELECT code, name FROM cc_actor_types ORDER BY sort_order;

-- Verify plans per actor type
SELECT at.code as actor, p.code as plan, p.name, p.monthly_price, p.tier_level
FROM cc_plans p
JOIN cc_actor_types at ON p.actor_type_id = at.id
ORDER BY at.sort_order, p.tier_level;

-- Verify entitlements
SELECT p.code as plan, pe.entitlement_key, pe.value_type, 
       pe.boolean_value, pe.numeric_value
FROM cc_plan_entitlements pe
JOIN cc_plans p ON pe.plan_id = p.id
ORDER BY p.code, pe.entitlement_key;

-- Count summary
SELECT 
  (SELECT COUNT(*) FROM cc_actor_types) as actor_types,
  (SELECT COUNT(*) FROM cc_plans) as plans,
  (SELECT COUNT(*) FROM cc_plan_entitlements) as entitlements;
```
