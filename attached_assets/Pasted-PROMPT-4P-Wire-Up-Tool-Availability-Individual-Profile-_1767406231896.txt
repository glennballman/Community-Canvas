PROMPT 4P: Wire Up Tool Availability + Individual Profile UI
sql-- =====================================================================
-- MISSING VIEWS & FUNCTIONS (Add these now)
-- =====================================================================

-- 1. Tools available for a specific job (what Pavel sees when bidding)
CREATE OR REPLACE VIEW v_tools_available_for_job AS
SELECT 
    sr.id as service_run_id,
    sr.title as run_title,
    ss.id as slot_id,
    ss.property_address,
    c.id as community_id,
    c.name as community_name,
    
    -- Service and its tool requirements
    s.id as service_id,
    s.name as service_name,
    t.id as tool_id,
    t.name as tool_name,
    str.is_required,
    
    -- Check each source in priority order
    -- Source 1: Property has it on-site
    (SELECT json_build_object(
        'source', 'property',
        'available', true,
        'owner_name', COALESCE(
            (SELECT full_name FROM cc_individuals WHERE id = pt.owner_user_id),
            'Property Owner'
        ),
        'usage_fee', COALESCE(pt.usage_fee, 0),
        'condition', pt.condition,
        'notes', pt.notes
    ) FROM sr_property_tools pt 
    WHERE pt.tool_id = t.id 
    AND pt.property_address = ss.property_address
    AND pt.available_to_providers = true
    LIMIT 1) as property_tool,
    
    -- Source 2: Individual tools available for rent in community
    (SELECT json_agg(json_build_object(
        'source', 'individual_rental',
        'available', true,
        'owner_id', it.individual_id,
        'owner_name', i.full_name,
        'daily_rate', it.rental_rate_daily,
        'weekly_rate', it.rental_rate_weekly,
        'location', it.current_location,
        'condition', it.condition
    )) FROM cc_individual_tools it
    JOIN cc_individuals i ON i.id = it.individual_id
    WHERE it.tool_id = t.id
    AND it.current_community_id = c.id
    AND it.available_for_rent = true) as individual_tools,
    
    -- Source 3: Provider/company tools available in community
    (SELECT json_agg(json_build_object(
        'source', 'provider_inventory',
        'available', true,
        'tenant_id', pt.tenant_id,
        'owner_name', ten.name,
        'daily_rate', pt.rental_rate_daily,
        'weekly_rate', pt.rental_rate_weekly,
        'location', pt.current_location,
        'condition', pt.condition
    )) FROM sr_provider_tools pt
    JOIN cc_tenants ten ON ten.id = pt.tenant_id
    WHERE pt.tool_id = t.id
    AND pt.current_community_id = c.id
    AND pt.is_available_for_rent = true) as provider_tools,
    
    -- Fallback info
    t.typical_daily_rental,
    t.typical_weekly_rental,
    t.transport_requirements

FROM sr_service_runs sr
JOIN sr_communities c ON c.id = sr.community_id
JOIN sr_service_slots ss ON ss.run_id = sr.id
LEFT JOIN sr_bundles b ON b.id = sr.bundle_id
LEFT JOIN sr_bundle_items bi ON bi.bundle_id = b.id
LEFT JOIN sr_services s ON s.id = bi.service_id
LEFT JOIN sr_service_tool_requirements str ON str.service_id = s.id
LEFT JOIN sr_tools t ON t.id = str.tool_id
WHERE t.id IS NOT NULL;

-- 2. Get full bid context for an individual viewing a run
CREATE OR REPLACE FUNCTION get_bid_context(
    p_individual_id UUID,
    p_service_run_id UUID
) RETURNS JSON AS $$
DECLARE
    result JSON;
BEGIN
    SELECT json_build_object(
        'individual', (
            SELECT json_build_object(
                'id', i.id,
                'name', i.full_name,
                'email', i.email,
                'current_community', (SELECT name FROM sr_communities WHERE id = i.current_community_id),
                'skills', COALESCE((
                    SELECT json_agg(json_build_object(
                        'id', sk.id,
                        'skill', sk.name,
                        'proficiency', isk.proficiency_level,
                        'verified', isk.verified
                    ))
                    FROM cc_individual_skills isk
                    JOIN sr_skills sk ON sk.id = isk.skill_id
                    WHERE isk.individual_id = i.id
                ), '[]'::json),
                'personal_tools', COALESCE((
                    SELECT json_agg(json_build_object(
                        'id', it.id,
                        'tool_id', t.id,
                        'tool', t.name,
                        'location', it.current_location,
                        'community', (SELECT name FROM sr_communities WHERE id = it.current_community_id),
                        'condition', it.condition,
                        'available_for_rent', it.available_for_rent,
                        'rental_rate_daily', it.rental_rate_daily
                    ))
                    FROM cc_individual_tools it
                    JOIN sr_tools t ON t.id = it.tool_id
                    WHERE it.individual_id = i.id
                ), '[]'::json)
            )
            FROM cc_individuals i
            WHERE i.id = p_individual_id
        ),
        'service_run', (
            SELECT json_build_object(
                'id', sr.id,
                'title', sr.title,
                'slug', sr.slug,
                'community_id', c.id,
                'community', c.name,
                'status', sr.status,
                'dates', json_build_object(
                    'start', sr.target_start_date,
                    'end', sr.target_end_date
                ),
                'slots', json_build_object(
                    'current', sr.current_slots,
                    'min', sr.min_slots,
                    'max', sr.max_slots
                ),
                'bundle', (
                    SELECT json_build_object(
                        'id', b.id,
                        'name', b.name,
                        'services', (
                            SELECT json_agg(json_build_object(
                                'service_id', s.id,
                                'name', s.name,
                                'quantity', bi.quantity
                            ))
                            FROM sr_bundle_items bi
                            JOIN sr_services s ON s.id = bi.service_id
                            WHERE bi.bundle_id = b.id
                        )
                    )
                    FROM sr_bundles b WHERE b.id = sr.bundle_id
                ),
                'estimated_mobilization', sr.estimated_mobilization_cost
            )
            FROM sr_service_runs sr
            JOIN sr_communities c ON c.id = sr.community_id
            WHERE sr.id = p_service_run_id
        ),
        'tool_requirements', COALESCE((
            SELECT json_agg(DISTINCT json_build_object(
                'tool_id', v.tool_id,
                'tool_name', v.tool_name,
                'service_name', v.service_name,
                'is_required', v.is_required,
                'property_tool', v.property_tool,
                'individual_tools', v.individual_tools,
                'provider_tools', v.provider_tools,
                'typical_daily_rental', v.typical_daily_rental
            ))
            FROM v_tools_available_for_job v
            WHERE v.service_run_id = p_service_run_id
        ), '[]'::json),
        'authorization_status', (
            SELECT json_build_object(
                'has_valid_waivers', COALESCE((
                    SELECT bool_and(NOT sw.is_expired)
                    FROM cc_signed_waivers sw
                    WHERE sw.individual_id = p_individual_id
                ), false),
                'has_valid_payment', COALESCE((
                    SELECT bool_or(verified AND NOT is_expired)
                    FROM cc_payment_methods
                    WHERE individual_id = p_individual_id
                ), false),
                'documents', COALESCE((
                    SELECT json_agg(json_build_object(
                        'type', document_type,
                        'verified', verified,
                        'expired', is_expired
                    ))
                    FROM cc_identity_documents
                    WHERE individual_id = p_individual_id
                ), '[]'::json)
            )
        )
    ) INTO result;
    
    RETURN result;
END;
$$ LANGUAGE plpgsql;

-- 3. Check what tools an individual already has for a run
CREATE OR REPLACE FUNCTION check_individual_tools_for_run(
    p_individual_id UUID,
    p_service_run_id UUID
) RETURNS JSON AS $$
DECLARE
    result JSON;
BEGIN
    SELECT json_build_object(
        'tools_you_have', COALESCE((
            SELECT json_agg(json_build_object(
                'tool_id', t.id,
                'tool_name', t.name,
                'your_location', it.current_location,
                'needed_for', (
                    SELECT json_agg(DISTINCT s.name)
                    FROM v_tools_available_for_job v
                    JOIN sr_services s ON s.id = v.service_id
                    WHERE v.service_run_id = p_service_run_id
                    AND v.tool_id = t.id
                )
            ))
            FROM cc_individual_tools it
            JOIN sr_tools t ON t.id = it.tool_id
            WHERE it.individual_id = p_individual_id
            AND t.id IN (
                SELECT tool_id FROM v_tools_available_for_job 
                WHERE service_run_id = p_service_run_id
            )
        ), '[]'::json),
        'tools_you_need', COALESCE((
            SELECT json_agg(json_build_object(
                'tool_id', v.tool_id,
                'tool_name', v.tool_name,
                'is_required', v.is_required,
                'available_on_property', v.property_tool IS NOT NULL,
                'available_for_rent', (v.individual_tools IS NOT NULL OR v.provider_tools IS NOT NULL),
                'best_option', CASE
                    WHEN v.property_tool IS NOT NULL THEN 'property'
                    WHEN v.individual_tools IS NOT NULL THEN 'individual_rental'
                    WHEN v.provider_tools IS NOT NULL THEN 'provider_rental'
                    ELSE 'bring_your_own'
                END
            ))
            FROM v_tools_available_for_job v
            WHERE v.service_run_id = p_service_run_id
            AND v.tool_id NOT IN (
                SELECT tool_id FROM cc_individual_tools 
                WHERE individual_id = p_individual_id
            )
        ), '[]'::json)
    ) INTO result;
    
    RETURN result;
END;
$$ LANGUAGE plpgsql;

-- =====================================================================
-- API ENDPOINTS NEEDED
-- =====================================================================

-- These are the endpoints your Express/API routes should implement:

-- GET /api/individuals/:id/profile
-- GET /api/individuals/:id/authorizations  
-- GET /api/individuals/:id/tools
-- GET /api/individuals/:id/skills
-- POST /api/individuals/:id/tools (add personal tool)
-- POST /api/individuals/:id/skills (add skill)

-- GET /api/rentals/categories
-- GET /api/rentals/items?community=bamfield
-- GET /api/rentals/items/:id
-- POST /api/rentals/items/:id/book
-- GET /api/rentals/items/:id/availability?start=X&end=Y

-- GET /api/service-runs/:id/bid-context?individual_id=X
-- GET /api/service-runs/:id/tool-availability?individual_id=X

-- POST /api/waivers/:template_slug/sign

-- =====================================================================
-- VERIFY
-- =====================================================================

SELECT 'Tool availability views and functions created' as status;
Now create the Individual Profile UI:
tsx// client/src/pages/profile/IndividualProfile.tsx

import React, { useState, useEffect } from 'react';
import { useAuth } from '../../contexts/AuthContext';

interface Individual {
  id: string;
  fullName: string;
  preferredName: string;
  email: string;
  phone: string;
  phoneVerified: boolean;
  emailVerified: boolean;
  photoUrl: string;
  homeCountry: string;
  homeRegion: string;
  currentCommunity: string;
  languages: string[];
  emergencyContactName: string;
  emergencyContactPhone: string;
  profileScore: number;
}

interface Document {
  id: string;
  documentType: string;
  documentNumber: string;
  issuingAuthority: string;
  expiresAt: string | null;
  verified: boolean;
  isExpired: boolean;
}

interface Waiver {
  id: string;
  templateSlug: string;
  templateName: string;
  activityTypes: string[];
  signedAt: string;
  expiresAt: string;
  isExpired: boolean;
}

interface Skill {
  id: string;
  skillId: string;
  skillName: string;
  category: string;
  proficiencyLevel: string;
  yearsExperience: number | null;
  verified: boolean;
}

interface PersonalTool {
  id: string;
  toolId: string;
  toolName: string;
  category: string;
  currentLocation: string;
  currentCommunity: string | null;
  condition: string;
  availableForRent: boolean;
  rentalRateDaily: number | null;
}

interface PaymentMethod {
  id: string;
  paymentType: string;
  displayName: string;
  lastFour: string;
  brand: string;
  isDefault: boolean;
  isExpired: boolean;
}

export default function IndividualProfile() {
  const { user, token } = useAuth();
  const [activeTab, setActiveTab] = useState<'overview' | 'documents' | 'skills' | 'tools' | 'waivers' | 'payments'>('overview');
  const [loading, setLoading] = useState(true);
  
  const [individual, setIndividual] = useState<Individual | null>(null);
  const [documents, setDocuments] = useState<Document[]>([]);
  const [waivers, setWaivers] = useState<Waiver[]>([]);
  const [skills, setSkills] = useState<Skill[]>([]);
  const [tools, setTools] = useState<PersonalTool[]>([]);
  const [payments, setPayments] = useState<PaymentMethod[]>([]);

  useEffect(() => {
    loadProfile();
  }, []);

  async function loadProfile() {
    setLoading(true);
    try {
      const res = await fetch('/api/individuals/me', {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      const data = await res.json();
      if (data.success) {
        setIndividual(data.individual);
        setDocuments(data.documents || []);
        setWaivers(data.waivers || []);
        setSkills(data.skills || []);
        setTools(data.tools || []);
        setPayments(data.paymentMethods || []);
      }
    } catch (err) {
      console.error('Failed to load profile:', err);
    } finally {
      setLoading(false);
    }
  }

  const profileComplete = individual?.profileScore || 0;
  const missingItems: string[] = [];
  if (!individual?.phoneVerified) missingItems.push('Verify phone');
  if (documents.filter(d => d.documentType === 'photo_id' && d.verified).length === 0) missingItems.push('Add photo ID');
  if (payments.filter(p => !p.isExpired).length === 0) missingItems.push('Add payment method');
  if (waivers.filter(w => !w.isExpired).length === 0) missingItems.push('Sign waiver');

  if (loading) {
    return <div className="p-6 text-center text-gray-400">Loading profile...</div>;
  }

  return (
    <div className="p-6 max-w-6xl mx-auto">
      {/* Header */}
      <div className="bg-gray-800 rounded-lg p-6 mb-6">
        <div className="flex items-start gap-6">
          {/* Avatar */}
          <div className="w-24 h-24 bg-gray-700 rounded-full flex items-center justify-center text-4xl">
            {individual?.photoUrl ? (
              <img src={individual.photoUrl} alt="" className="w-full h-full rounded-full object-cover" />
            ) : (
              'üë§'
            )}
          </div>
          
          {/* Info */}
          <div className="flex-1">
            <h1 className="text-2xl font-bold text-white">
              {individual?.fullName || 'Complete Your Profile'}
            </h1>
            <p className="text-gray-400">{individual?.email}</p>
            
            <div className="flex items-center gap-4 mt-2">
              {individual?.emailVerified && (
                <span className="text-xs bg-green-600/20 text-green-400 px-2 py-1 rounded">
                  ‚úì Email Verified
                </span>
              )}
              {individual?.phoneVerified && (
                <span className="text-xs bg-green-600/20 text-green-400 px-2 py-1 rounded">
                  ‚úì Phone Verified
                </span>
              )}
              {individual?.currentCommunity && (
                <span className="text-xs bg-blue-600/20 text-blue-400 px-2 py-1 rounded">
                  üìç {individual.currentCommunity}
                </span>
              )}
            </div>
          </div>
          
          {/* Profile Score */}
          <div className="text-right">
            <div className="text-3xl font-bold text-white">{profileComplete}%</div>
            <div className="text-sm text-gray-400">Profile Complete</div>
            <div className="w-32 h-2 bg-gray-700 rounded-full mt-2">
              <div 
                className="h-2 bg-green-500 rounded-full transition-all"
                style={{ width: `${profileComplete}%` }}
              />
            </div>
          </div>
        </div>
        
        {/* Missing Items */}
        {missingItems.length > 0 && (
          <div className="mt-4 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
            <div className="text-yellow-400 text-sm font-medium mb-1">
              Complete your profile to unlock all features:
            </div>
            <div className="flex flex-wrap gap-2">
              {missingItems.map(item => (
                <span key={item} className="text-xs bg-yellow-500/20 text-yellow-300 px-2 py-1 rounded">
                  {item}
                </span>
              ))}
            </div>
          </div>
        )}
      </div>

      {/* Stats Bar */}
      <div className="grid grid-cols-5 gap-4 mb-6">
        <div className="bg-gray-800 rounded-lg p-4 text-center">
          <div className="text-2xl font-bold text-white">{documents.length}</div>
          <div className="text-sm text-gray-400">Documents</div>
        </div>
        <div className="bg-gray-800 rounded-lg p-4 text-center">
          <div className="text-2xl font-bold text-white">{waivers.filter(w => !w.isExpired).length}</div>
          <div className="text-sm text-gray-400">Valid Waivers</div>
        </div>
        <div className="bg-gray-800 rounded-lg p-4 text-center">
          <div className="text-2xl font-bold text-white">{skills.length}</div>
          <div className="text-sm text-gray-400">Skills</div>
        </div>
        <div className="bg-gray-800 rounded-lg p-4 text-center">
          <div className="text-2xl font-bold text-white">{tools.length}</div>
          <div className="text-sm text-gray-400">Personal Tools</div>
        </div>
        <div className="bg-gray-800 rounded-lg p-4 text-center">
          <div className="text-2xl font-bold text-white">{payments.filter(p => !p.isExpired).length}</div>
          <div className="text-sm text-gray-400">Payment Methods</div>
        </div>
      </div>

      {/* Tabs */}
      <div className="flex gap-2 mb-6 border-b border-gray-700 pb-2">
        {[
          { key: 'overview', label: 'üìã Overview' },
          { key: 'documents', label: 'ü™™ Documents' },
          { key: 'skills', label: 'üéØ Skills' },
          { key: 'tools', label: 'üîß My Tools' },
          { key: 'waivers', label: 'üìù Waivers' },
          { key: 'payments', label: 'üí≥ Payments' }
        ].map(tab => (
          <button
            key={tab.key}
            onClick={() => setActiveTab(tab.key as any)}
            className={`px-4 py-2 rounded-t-lg ${
              activeTab === tab.key
                ? 'bg-gray-800 text-white'
                : 'text-gray-400 hover:text-white'
            }`}
          >
            {tab.label}
          </button>
        ))}
      </div>

      {/* Tab Content */}
      <div className="bg-gray-800 rounded-lg p-6">
        {activeTab === 'overview' && (
          <div className="space-y-6">
            <h2 className="text-lg font-semibold text-white">Profile Overview</h2>
            
            {/* Quick Actions */}
            <div className="grid grid-cols-3 gap-4">
              <button className="p-4 bg-blue-600/20 hover:bg-blue-600/30 rounded-lg text-left">
                <div className="text-xl mb-1">üö£</div>
                <div className="text-white font-medium">Rent Equipment</div>
                <div className="text-sm text-gray-400">Kayaks, ATVs, tools</div>
              </button>
              <button className="p-4 bg-green-600/20 hover:bg-green-600/30 rounded-lg text-left">
                <div className="text-xl mb-1">üî®</div>
                <div className="text-white font-medium">Find Work</div>
                <div className="text-sm text-gray-400">Browse service runs</div>
              </button>
              <button className="p-4 bg-purple-600/20 hover:bg-purple-600/30 rounded-lg text-left">
                <div className="text-xl mb-1">üìã</div>
                <div className="text-white font-medium">My Bookings</div>
                <div className="text-sm text-gray-400">Rentals & reservations</div>
              </button>
            </div>
            
            {/* Recent Activity */}
            <div>
              <h3 className="text-white font-medium mb-3">Your Capabilities Summary</h3>
              <div className="bg-gray-900 rounded-lg p-4">
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <div className="text-sm text-gray-400 mb-2">Top Skills</div>
                    {skills.slice(0, 3).map(s => (
                      <div key={s.id} className="flex items-center gap-2 mb-1">
                        <span className="text-white">{s.skillName}</span>
                        <span className="text-xs text-gray-500">({s.proficiencyLevel})</span>
                        {s.verified && <span className="text-green-400 text-xs">‚úì</span>}
                      </div>
                    ))}
                    {skills.length === 0 && (
                      <div className="text-gray-500 text-sm">No skills added yet</div>
                    )}
                  </div>
                  <div>
                    <div className="text-sm text-gray-400 mb-2">Your Tools</div>
                    {tools.slice(0, 3).map(t => (
                      <div key={t.id} className="flex items-center gap-2 mb-1">
                        <span className="text-white">{t.toolName}</span>
                        {t.currentCommunity && (
                          <span className="text-xs text-gray-500">({t.currentCommunity})</span>
                        )}
                      </div>
                    ))}
                    {tools.length === 0 && (
                      <div className="text-gray-500 text-sm">No tools registered yet</div>
                    )}
                  </div>
                </div>
              </div>
            </div>
          </div>
        )}

        {activeTab === 'skills' && (
          <div>
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-lg font-semibold text-white">My Skills</h2>
              <button className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">
                + Add Skill
              </button>
            </div>
            
            <div className="space-y-3">
              {skills.map(skill => (
                <div key={skill.id} className="bg-gray-900 rounded-lg p-4 flex items-center justify-between">
                  <div>
                    <div className="flex items-center gap-2">
                      <span className="text-white font-medium">{skill.skillName}</span>
                      {skill.verified && (
                        <span className="text-xs bg-green-600/20 text-green-400 px-2 py-0.5 rounded">Verified</span>
                      )}
                    </div>
                    <div className="text-sm text-gray-400">
                      {skill.category} ‚Ä¢ {skill.proficiencyLevel}
                      {skill.yearsExperience && ` ‚Ä¢ ${skill.yearsExperience} years`}
                    </div>
                  </div>
                  <button className="text-gray-400 hover:text-white">Edit</button>
                </div>
              ))}
              
              {skills.length === 0 && (
                <div className="text-center py-8 text-gray-500">
                  No skills added yet. Add your skills to get matched with jobs!
                </div>
              )}
            </div>
          </div>
        )}

        {activeTab === 'tools' && (
          <div>
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-lg font-semibold text-white">My Personal Tools</h2>
              <button className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">
                + Add Tool
              </button>
            </div>
            
            <div className="space-y-3">
              {tools.map(tool => (
                <div key={tool.id} className="bg-gray-900 rounded-lg p-4">
                  <div className="flex items-center justify-between">
                    <div>
                      <div className="flex items-center gap-2">
                        <span className="text-white font-medium">{tool.toolName}</span>
                        <span className={`text-xs px-2 py-0.5 rounded ${
                          tool.condition === 'excellent' ? 'bg-green-600/20 text-green-400' :
                          tool.condition === 'good' ? 'bg-blue-600/20 text-blue-400' :
                          'bg-yellow-600/20 text-yellow-400'
                        }`}>
                          {tool.condition}
                        </span>
                      </div>
                      <div className="text-sm text-gray-400">
                        üìç {tool.currentLocation || tool.currentCommunity || 'Location not set'}
                      </div>
                    </div>
                    <div className="text-right">
                      {tool.availableForRent ? (
                        <div>
                          <div className="text-green-400 text-sm">Available for rent</div>
                          <div className="text-white">${tool.rentalRateDaily}/day</div>
                        </div>
                      ) : (
                        <div className="text-gray-500 text-sm">Personal use only</div>
                      )}
                    </div>
                  </div>
                </div>
              ))}
              
              {tools.length === 0 && (
                <div className="text-center py-8 text-gray-500">
                  <div className="text-4xl mb-2">üîß</div>
                  No tools registered yet. Add your tools to unlock more job opportunities!
                </div>
              )}
            </div>
          </div>
        )}

        {activeTab === 'waivers' && (
          <div>
            <h2 className="text-lg font-semibold text-white mb-4">Liability Waivers</h2>
            <p className="text-gray-400 text-sm mb-4">
              Sign waivers once and they're valid for all activities of that type. No more re-signing!
            </p>
            
            <div className="space-y-3">
              {waivers.map(waiver => (
                <div key={waiver.id} className={`bg-gray-900 rounded-lg p-4 ${waiver.isExpired ? 'opacity-60' : ''}`}>
                  <div className="flex items-center justify-between">
                    <div>
                      <div className="flex items-center gap-2">
                        <span className="text-white font-medium">{waiver.templateName}</span>
                        {waiver.isExpired ? (
                          <span className="text-xs bg-red-600/20 text-red-400 px-2 py-0.5 rounded">Expired</span>
                        ) : (
                          <span className="text-xs bg-green-600/20 text-green-400 px-2 py-0.5 rounded">Valid</span>
                        )}
                      </div>
                      <div className="text-sm text-gray-400">
                        Covers: {waiver.activityTypes.join(', ')}
                      </div>
                      <div className="text-xs text-gray-500">
                        Signed: {new Date(waiver.signedAt).toLocaleDateString()} ‚Ä¢ 
                        Expires: {new Date(waiver.expiresAt).toLocaleDateString()}
                      </div>
                    </div>
                    {waiver.isExpired && (
                      <button className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm">
                        Re-sign
                      </button>
                    )}
                  </div>
                </div>
              ))}
              
              {/* Unsigned waivers - show available templates */}
              <div className="border-t border-gray-700 pt-4 mt-4">
                <div className="text-sm text-gray-400 mb-3">Available waivers to sign:</div>
                <div className="grid grid-cols-2 gap-3">
                  <button className="p-3 bg-gray-700 hover:bg-gray-600 rounded-lg text-left">
                    <div className="text-white">üö£ Watercraft Waiver</div>
                    <div className="text-xs text-gray-400">Kayaks, paddleboards, canoes</div>
                  </button>
                  <button className="p-3 bg-gray-700 hover:bg-gray-600 rounded-lg text-left">
                    <div className="text-white">üèéÔ∏è Motorized Vehicle Waiver</div>
                    <div className="text-xs text-gray-400">ATVs, side-by-sides, golf carts</div>
                  </button>
                  <button className="p-3 bg-gray-700 hover:bg-gray-600 rounded-lg text-left">
                    <div className="text-white">üîß Power Tool Waiver</div>
                    <div className="text-xs text-gray-400">Tools, ladders, equipment</div>
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}

        {activeTab === 'documents' && (
          <div>
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-lg font-semibold text-white">Identity Documents</h2>
              <button className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">
                + Add Document
              </button>
            </div>
            
            <div className="space-y-3">
              {documents.map(doc => (
                <div key={doc.id} className="bg-gray-900 rounded-lg p-4 flex items-center justify-between">
                  <div>
                    <div className="flex items-center gap-2">
                      <span className="text-white font-medium">
                        {doc.documentType.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}
                      </span>
                      {doc.verified ? (
                        <span className="text-xs bg-green-600/20 text-green-400 px-2 py-0.5 rounded">Verified</span>
                      ) : (
                        <span className="text-xs bg-yellow-600/20 text-yellow-400 px-2 py-0.5 rounded">Pending</span>
                      )}
                      {doc.isExpired && (
                        <span className="text-xs bg-red-600/20 text-red-400 px-2 py-0.5 rounded">Expired</span>
                      )}
                    </div>
                    <div className="text-sm text-gray-400">
                      {doc.issuingAuthority}
                      {doc.expiresAt && ` ‚Ä¢ Expires: ${new Date(doc.expiresAt).toLocaleDateString()}`}
                    </div>
                  </div>
                  <button className="text-gray-400 hover:text-white">View</button>
                </div>
              ))}
              
              {documents.length === 0 && (
                <div className="text-center py-8 text-gray-500">
                  <div className="text-4xl mb-2">ü™™</div>
                  No documents on file. Add your ID to enable rentals and work.
                </div>
              )}
            </div>
          </div>
        )}

        {activeTab === 'payments' && (
          <div>
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-lg font-semibold text-white">Payment Methods</h2>
              <button className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">
                + Add Payment Method
              </button>
            </div>
            
            <div className="space-y-3">
              {payments.map(pm => (
                <div key={pm.id} className="bg-gray-900 rounded-lg p-4 flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className="text-2xl">
                      {pm.brand === 'Visa' ? 'üí≥' : pm.brand === 'Mastercard' ? 'üí≥' : 'üè¶'}
                    </div>
                    <div>
                      <div className="flex items-center gap-2">
                        <span className="text-white font-medium">{pm.displayName}</span>
                        {pm.isDefault && (
                          <span className="text-xs bg-blue-600/20 text-blue-400 px-2 py-0.5 rounded">Default</span>
                        )}
                      </div>
                      <div className="text-sm text-gray-400">
                        ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ {pm.lastFour}
                      </div>
                    </div>
                  </div>
                  <button className="text-gray-400 hover:text-white">Remove</button>
                </div>
              ))}
              
              {payments.length === 0 && (
                <div className="text-center py-8 text-gray-500">
                  <div className="text-4xl mb-2">üí≥</div>
                  No payment methods on file. Add one to enable rentals.
                </div>
              )}
            </div>
          </div>
        )}
      </div>
    </div>
  );
}
Add the route to App.tsx:
tsx<Route path="/profile" element={<IndividualProfile />} />
And add to navigation in AdminLayout.tsx under user menu or as a main nav item.

This creates:

v_tools_available_for_job - Shows all tool sources for a service run
get_bid_context() - Full context for Pavel when viewing a job
check_individual_tools_for_run() - What you have vs what you need
Individual Profile UI - Complete profile management with tabs

Run this and test the profile page! 