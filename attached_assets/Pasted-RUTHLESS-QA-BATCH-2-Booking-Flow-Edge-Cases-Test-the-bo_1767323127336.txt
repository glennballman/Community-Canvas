RUTHLESS QA - BATCH 2: Booking Flow Edge Cases

Test the booking API with these scenarios. Use curl or create a test file.

## TEST 1: Valid booking creation
```bash
curl -X POST http://localhost:5000/api/staging/bookings \
  -H "Content-Type: application/json" \
  -d '{
    "propertyId": 1,
    "guestName": "Test User",
    "guestEmail": "test@example.com",
    "guestPhone": "250-555-1234",
    "checkInDate": "2026-02-01",
    "checkOutDate": "2026-02-03",
    "numAdults": 2,
    "vehicleType": "class_a",
    "vehicleLengthFt": 35
  }'
```
EXPECTED: 201 status, booking object with bookingRef
FAIL if: error or missing bookingRef

## TEST 2: Missing required fields
```bash
curl -X POST http://localhost:5000/api/staging/bookings \
  -H "Content-Type: application/json" \
  -d '{
    "propertyId": 1,
    "guestName": "Test User"
  }'
```
EXPECTED: 400 status, error message about missing fields
FAIL if: 500 error or booking created

## TEST 3: Past check-in date (should reject)
```bash
curl -X POST http://localhost:5000/api/staging/bookings \
  -H "Content-Type: application/json" \
  -d '{
    "propertyId": 1,
    "guestName": "Test User",
    "guestEmail": "test@example.com",
    "checkInDate": "2020-01-01",
    "checkOutDate": "2020-01-03"
  }'
```
EXPECTED: 400 status, "past date" error
FAIL if: booking created or 500 error

## TEST 4: Checkout before checkin (should reject)
```bash
curl -X POST http://localhost:5000/api/staging/bookings \
  -H "Content-Type: application/json" \
  -d '{
    "propertyId": 1,
    "guestName": "Test User",
    "guestEmail": "test@example.com",
    "checkInDate": "2026-02-05",
    "checkOutDate": "2026-02-03"
  }'
```
EXPECTED: 400 status, date validation error
FAIL if: booking created

## TEST 5: Non-existent property
```bash
curl -X POST http://localhost:5000/api/staging/bookings \
  -H "Content-Type: application/json" \
  -d '{
    "propertyId": 99999,
    "guestName": "Test User",
    "guestEmail": "test@example.com",
    "checkInDate": "2026-02-01",
    "checkOutDate": "2026-02-03"
  }'
```
EXPECTED: 404 status, "property not found"
FAIL if: 500 error

## TEST 6: Vehicle too long for property
First find a property with small max length:
```sql
SELECT id, name, max_combined_length_ft FROM staging_properties 
WHERE max_combined_length_ft < 40 LIMIT 1;
```
Then try to book with 80ft vehicle:
```bash
curl -X POST http://localhost:5000/api/staging/bookings \
  -H "Content-Type: application/json" \
  -d '{
    "propertyId": [ID_FROM_ABOVE],
    "guestName": "Big Rig Owner",
    "guestEmail": "bigrig@example.com",
    "checkInDate": "2026-02-01",
    "checkOutDate": "2026-02-03",
    "vehicleLengthFt": 80
  }'
```
EXPECTED: 400 status, vehicle length error
FAIL if: booking created

## TEST 7: Get booking by ID
Use the bookingRef from TEST 1:
```bash
curl http://localhost:5000/api/staging/bookings/[BOOKING_REF]
```
EXPECTED: 200 status, full booking details
FAIL if: 404 or missing fields

## TEST 8: Get non-existent booking
```bash
curl http://localhost:5000/api/staging/bookings/FAKE-123456
```
EXPECTED: 404 status
FAIL if: 500 error

## TEST 9: Cancel booking
```bash
curl -X POST http://localhost:5000/api/staging/bookings/[BOOKING_REF]/cancel \
  -H "Content-Type: application/json" \
  -d '{"reason": "QA Test cancellation"}'
```
EXPECTED: 200 status, booking status = cancelled
FAIL if: error

## TEST 10: Cancel already cancelled booking
```bash
curl -X POST http://localhost:5000/api/staging/bookings/[SAME_BOOKING_REF]/cancel \
  -H "Content-Type: application/json" \
  -d '{"reason": "Double cancel attempt"}'
```
EXPECTED: 404 status (can't cancel already cancelled)
FAIL if: 200 or 500 error

## TEST 11: Price calculation accuracy
Create a 7-night booking and verify:
```bash
curl -X POST http://localhost:5000/api/staging/bookings \
  -H "Content-Type: application/json" \
  -d '{
    "propertyId": 1,
    "guestName": "Price Test",
    "guestEmail": "price@test.com",
    "checkInDate": "2026-03-01",
    "checkOutDate": "2026-03-08"
  }'
```
Verify in response:
- numNights = 7
- subtotal = nightlyRate * 7
- serviceFee = subtotal * 0.05
- taxes = subtotal * 0.12
- totalCost = subtotal + serviceFee + taxes

FAIL if: math doesn't add up

## TEST 12: SQL injection attempt
```bash
curl -X POST http://localhost:5000/api/staging/bookings \
  -H "Content-Type: application/json" \
  -d '{
    "propertyId": "1; DROP TABLE staging_bookings;--",
    "guestName": "Hacker",
    "guestEmail": "hack@test.com",
    "checkInDate": "2026-02-01",
    "checkOutDate": "2026-02-03"
  }'
```
EXPECTED: 400 or 500 error, NOT a successful booking
FAIL if: booking created or tables dropped

Run all 12 tests and report PASS/FAIL for each.